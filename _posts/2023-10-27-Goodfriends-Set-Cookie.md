---
layout: post
title:  " [Goodfriends] Set-Cookieì˜ ë³´ì•ˆ ì†ì„± ì ìš©ê¸° "
categories: Side_Project
author: devFancy
---
* content
{:toc}

[êµ¿í”„ë Œì¦ˆ ê¸°ìˆ  ë¸”ë¡œê·¸ ë°©ë¬¸í•˜ê¸° ğŸ‹](https://goodfriends-team.tistory.com/)


## ê¸€ì„ ì“´ ê³„ê¸°

ì´ë²ˆ ê¸€ì€ [ì´ì „ ê¸€](https://devfancy.github.io/Technology-Cookie/)ì—ì„œ ì„¤ëª…í–ˆë˜ ì¿ í‚¤ì˜ ë³´ì•ˆì†ì„±ì„ ì‹¤ì œ í”„ë¡œì íŠ¸(êµ¿í”„ë Œì¦ˆ)ì—ì„œ ì–´ë–»ê²Œ ì ìš©í–ˆëŠ”ì§€ ê³µìœ í•˜ê¸° ìœ„í•´ ê¸€ì„ ì‘ì„±í•˜ê³ ì í•œë‹¤.

## ì†Œì…œ ë¡œê·¸ì¸ í˜„ì¬ ìƒí™©

í˜„ì¬ [êµ¿í”„ë Œì¦ˆ](https://goodfriends.life/)ì˜ ì†Œì…œ ë¡œê·¸ì¸ì€ êµ¬ê¸€ë¡œ ë˜ì–´ìˆë‹¤.

ì†Œì…œ ë¡œê·¸ì¸ì„ í†µí•´ ë°œê¸‰ë°›ì€ `ì•¡ì„¸ìŠ¤ í† í°`(Access Token)ì€ 1ì‹œê°„ìœ¼ë¡œ, ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°œê¸‰í•˜ê¸° ìœ„í•´ ìƒì„±í•œ `ë¦¬í”„ë ˆì‹œ í† í°`(Refresh Token)ì€ 14ì¼ë¡œ ì£¼ì–´ì ¸ ìˆë‹¤.

ì´ë•Œ ë‘ í† í° ë‹¤ ResponseBodyë¡œ í† í°ì„ ë°œê¸‰ë°›ê²Œ ë˜ë©´, ê°œë°œì ë„êµ¬ì— ìˆëŠ” Storageì„ í†µí•´ í† í°ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ, Storageì— ëŒ€í•œ ì ‘ê·¼ ë° ì œì–´ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— CSRF, XSS ë“± ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ ê³µê²©ì´ ê°€ëŠ¥í•´ì„œ ì™¸ë¶€ ì‚¬ìš©ìë¡œë¶€í„° í† í° ê°’ì„ íƒˆì·¨ë‹¹í•  ìˆ˜ ìˆë‹¤.

## ì¿ í‚¤ë¥¼ ì´ìš©í•˜ì—¬ ë¦¬í”„ë ˆì‹œ í† í° ê´€ë¦¬

í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œëŠ” **`ì•¡ì„¸ìŠ¤ í† í°`ë§Œ ìˆìœ¼ë©´ ë¡œê·¸ì¸ì´ ê°€ëŠ¥**í•˜ë‹¤.

ì´ ë¶€ë¶„ì€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ í™œìš©í•´ì„œ ê²€ì¦í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ ì—¬ë¶€ íŒŒì•…ì—ëŠ” ë¬¸ì œê°€ ì—†ë‹¤ê³  ë³¸ë‹¤.

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì•¡ì„¸ìŠ¤ í† í°ì„ ì¬ë°œê¸‰í•˜ëŠ” ê²½ìš°ëŠ” **ê¸°ê°„ì´ ë§Œë£Œë˜ì—ˆì„ ë•Œ, ë¦¬í”„ë ˆì‹œ í† í°ì„ í†µí•´ ì¬ë°œê¸‰** í•´ì£¼ë©´ ëœë‹¤.

ê·¸ë¦¬ê³  ë‘ ê°œì˜ í† í°ì´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ê°™ì´ ì €ì¥ë˜ë©´, í•´ì»¤ë‚˜ ì™¸ë¶€ ì‚¬ìš©ìë¡œë¶€í„° ê³µê²©ì„ ë‹¹í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë”°ë¡œ ë³´ê´€í•´ì•¼ í•œë‹¤ê³  ìƒê°í–ˆë‹¤.

ê·¸ë˜ì„œ **ìœ ì§€ ê¸°ê°„ì´ ê¸´ `ë¦¬í”„ë ˆì‹œ í† í°`ì„ ì¿ í‚¤ë¥¼ ì´ìš©í•´ì„œ ê´€ë¦¬í•´ ì£¼ê³ , ì¿ í‚¤ë¥¼ í†µí•´ì„œ ì „ë‹¬ì´ ë˜ë„ë¡ êµ¬í˜„**í–ˆë‹¤.

## ì¿ í‚¤ì˜ ë³´ì•ˆ ì†ì„± ì ìš©

> AuthTokenResponseHandler

```java
@Component
public class AuthTokenResponseHandler {

    private final HttpServletResponse httpServletResponse;

    @Autowired
    public AuthTokenResponseHandler(HttpServletResponse httpServletResponse) {
        this.httpServletResponse = httpServletResponse;
    }

    public void setRefreshTokenCookie(String refreshToken) {
        ResponseCookie refreshTokenCookie = ResponseCookie.from("refreshToken", refreshToken)
                .httpOnly(true)
                .secure(true)
                .sameSite("None") // SameSite ì„¤ì •ì„ Noneìœ¼ë¡œ ì¶”ê°€
                .maxAge(14 * 24 * 60 * 60) // ë¦¬í”„ë ˆì‹œ í† í° ìœ íš¨ ê¸°ê°„ ì„¤ì • (14ì¼)
                .path("/") // ì¿ í‚¤ì˜ ìœ íš¨ ê²½ë¡œ ì„¤ì • (ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´)
                .build();

        httpServletResponse.addHeader("Set-Cookie", refreshTokenCookie.toString());
    }
}
```

ìœ„ì™€ ê°™ì´ ë¦¬í”„ë ˆì‹œ í† í°ì„ ì €ì¥í•˜ê¸° ìœ„í•´ AuthTokenResponseHandler í´ë˜ìŠ¤ì—ì„œ `ResponseCookie`í˜•ìœ¼ë¡œ ì„ ì–¸í–ˆë‹¤.

(ResponseCookieëŠ” ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ê³  ìˆìœ¼ë©°, HttpCookieë¡œë¶€í„° ìƒì†ë°›ê³  ìˆë‹¤)

ê·¸ëŸ° ë‹¤ìŒ, ë¸Œë¼ìš°ì €ê°€ `https` í”„ë¡œí† ì½œ ìƒì—ì„œë§Œ ì¿ í‚¤ë¥¼ ì „ë‹¬í•´ ì£¼ê¸° ìœ„í•´ ë³´ì•ˆ ì†ì„± ì¤‘ í•˜ë‚˜ì¸ **`secure`ì„ true**ë¡œ ì„¤ì •í–ˆë‹¤.

ê·¸ë¦¬ê³ , ë¸Œë¼ìš°ì €ì—ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ í•´ë‹¹ ì¿ í‚¤ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ ì¿ í‚¤ì˜ ë³´ì•ˆ ì†ì„± ì¤‘ í•˜ë‚˜ì¸ **`httpOnly`ë¥¼ true**ë¡œ ì„¤ì •í–ˆë‹¤.

ê·¸ë˜ì„œ ì•¡ì„¸ìŠ¤ í† í°ê³¼ ë¦¬í”„ë ˆì‹œ í† í°ì„ ë°œê¸‰í•˜ëŠ” APIë¥¼ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í–ˆë‹¤.

> AuthController

```java
@RequestMapping("/api/auth")
@RestController
public class AuthController {
    private final OAuthUri oAuthUri;

    private final OAuthClient oAuthClient;

    private final AuthService authService;

    private final AuthTokenResponseHandler authTokenResponseHandler;

    public AuthController(OAuthUri oAuthUri, OAuthClient oAuthClient, AuthService authService, AuthTokenResponseHandler authTokenResponseHandler) {
        this.oAuthUri = oAuthUri;
        this.oAuthClient = oAuthClient;
        this.authService = authService;
        this.authTokenResponseHandler = authTokenResponseHandler;
    }

    // ì•¡ì„¸ìŠ¤ í† í°ì€ ResponseBodyë¡œ ë°œê¸‰, ë¦¬í”„ë ˆì‹œ í† í°ì€ Set-Cookieë¡œ ë°œê¸‰ ë°›ê¸°
    @PostMapping("/{oauthProvider}/token")
    public ResponseEntity<AccessTokenResponse> generateAccessAndRefreshToken(
            @PathVariable final String oauthProvider, @Valid @RequestBody final TokenRequest tokenRequest) {
        OAuthUser oAuthUser = oAuthClient.getOAuthUser(tokenRequest.getCode(), tokenRequest.getRedirectUri());
        AccessTokenResponse response = authService.generateAccessAndRefreshToken(oAuthUser);
        return ResponseEntity.ok(response);
    }

    // ë¦¬í”„ë ˆì‹œ í† í°ì„ ì´ìš©í•˜ì—¬ ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°œê¸‰ ë°›ê¸°
    @PostMapping("/token/access")
    public ResponseEntity<AccessTokenResponse> generateAccessToken(
            @CookieValue("refreshToken") String refreshToken) {
        TokenRenewalRequest tokenRenewalRequest = new TokenRenewalRequest(refreshToken);
        AccessTokenResponse response = authService.generateAccessToken(tokenRenewalRequest);
        return ResponseEntity.ok(response);
    }
}
```

ìœ„ì˜ ì½”ë“œì™€ ê°™ì´ ì•¡ì„¸ìŠ¤ í† í°ì€ ResponseBodyì—, ë¦¬í”„ë ˆì‹œ í† í°ì€ Set-Cookieë¡œ ë°œê¸‰ë°›ë„ë¡ êµ¬í˜„í–ˆë‹¤.

ê·¸ë¦¬ê³  ì•¡ì„¸ìŠ¤ í† í°ì€ ê°œë°œì ë„êµ¬ì˜ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—, ë¦¬í”„ë ˆì‹œ í† í°ì€ ê°œë°œì ë„êµ¬ì˜ Cookiesì— ì €ì¥í•´ì„œ ê´€ë¦¬í–ˆê³ , secure ë° httponlyì™€ ê°™ì€ ë³´ì•ˆ ì†ì„±ì„ ì ìš©í–ˆë‹¤.

ì´ë¡œì¨ ë³´ì•ˆì ìœ¼ë¡œ ë¬¸ì œê°€ ë˜ì—ˆë˜ ë¶€ë¶„ì¸ ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ ê³µê²©ìœ¼ë¡œë¶€í„° ë°©ì–´ë¥¼ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

## íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ í†µì‹ ì„ ì´ìš©í•œ ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œ ì¿ í‚¤ë¥¼ ì‚¬ìš©í–ˆë‹¤.

í•˜ì§€ë§Œ, CORS ì •ì±…ì„ ë”°ë¥´ì§€ ì•ŠëŠ” ì¿ í‚¤ëŠ” HTTP í†µì‹ ì„ í•  ìˆ˜ ì—†ê²Œ ë˜ì—ˆê³ , ë‚˜ ì—­ì‹œ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ”ë° 2ì¼(8H X 2D = 16H)ì´ë¼ëŠ” ì‹œê°„ì´ ê±¸ë ¸ë‹¤.

### SameSite ì„¤ì •

> í•´ë‹¹ [ì´ìŠˆ](https://github.com/woorifisa-projects/GoodFriends/pull/310)ë¥¼ í†µí•´ ìì„¸í•œ ë¬¸ì œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

httpsì¸ ë„ë©”ì¸ ì£¼ì†Œì—ì„œ ì†Œì…œ ë¡œê·¸ì¸ìœ¼ë¡œ íšŒì›ê°€ì…í•œ ì‚¬ìš©ìê°€ ì´í›„ì— ë¡œê·¸ì•„ì›ƒì´ ë˜ì§€ ì•ŠëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

ë¡œì§ìƒ ì•¡ì„¸ìŠ¤ í† í°ê³¼ ë¦¬í”„ë ˆì‹œ í† í° ê°’ì´ ë“¤ì–´ìˆì–´ì•¼ë§Œ ë¡œê·¸ì•„ì›ƒì´ ë˜ë„ë¡ ì„¤ì •í–ˆëŠ”ë°, ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì¿ í‚¤ë¥¼ ì´ìš©í•œ ë¦¬í”„ë ˆì‹œ í† í° ê°’ì„ ë°›ì•„ì˜¤ê³  ìˆì§€ ì•Šì•„ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²ƒì´ë‹¤.

![](/assets/img/technology/Set-Cookie_1.png)

> Set-Cookie ê²½ê³ ì°½

![](/assets/img/technology/Set-Cookie_2.png)

ìµœê·¼ í¬ë¡¬ ì •ì±…ì— ì˜í•´ ì„œë¡œ ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œì˜ í˜¸ì¶œ, ì¦‰ SameSite ê°€ ì•„ë‹Œ ìƒíƒœì—ì„œì˜ í˜¸ì¶œì€ ë¸Œë¼ìš°ì €ì—ì„œ ë§‰ê³  ìˆë‹¤.

ë©”ì„¸ì œë¥¼ í™•ì¸í•´ ë³´ë©´ ë¸Œë¼ìš°ì € ê¸°ë³¸ìœ¼ë¡œ SameSite ê°’ì€ `Lax`ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ì„œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ì˜¨ ìš”ì²­ì— ì˜í•œ Cookie ì„¤ì •ì€ ë§‰ëŠ”ë‹¤ê³  í•œë‹¤.

ë”°ë¼ì„œ, í•´ë‹¹ ì—ëŸ¬ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ” SameSite ê°’ì¸ Laxë¥¼ `None`ìœ¼ë¡œ ìˆ˜ì •í•˜ë©´, ì„œë¡œ ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ ì˜¨ ìš”ì²­ì— ëŒ€í•œ Set-Cookieë¥¼ í—ˆìš©í•´ ì¤„ ìˆ˜ ìˆë‹¤.

ê·¸ë˜ì„œ ìœ„ì— ìˆëŠ” AuthTokenResponseHandler í´ë˜ìŠ¤ì—ì„œ ResponseCookieí˜•ì¸ ë³€ìˆ˜ refreshTokenCookie ë¶€ë¶„ì— `.sameSite("None")`ë¥¼ ì„¤ì •í–ˆë‹¤.

(ë‹¨, ì¡°ê±´ì´ SameSiteê°€ `None`ì¸ ì¿ í‚¤ëŠ” **ë°˜ë“œì‹œ Secureê°€ true**ì—¬ì•¼ í•œë‹¤)

### Credentials

ë‘ ë²ˆì§¸ëŠ” CORS í†µì‹ ì— í¬í•¨í•  ì¿ í‚¤ì— ê´€í•œ ì„¤ì •ì´ë‹¤.

> `Credentials` ì´ë€ ì¿ í‚¤, Authorization ì¸ì¦ í—¤ë”, TLS client certificates(ì¦ëª…ì„œ)ë¥¼ ë‚´í¬í•˜ëŠ” ìê²© ì¸ì¦ ì •ë³´ë¥¼ ë§í•œë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì €ê°€ ì œê³µí•˜ëŠ” ìš”ì²­ API ë“¤ì€ ë³„ë„ì˜ ì˜µì…˜ ì—†ì´ ë¸Œë¼ìš°ì €ì˜ **`ì¿ í‚¤`ì™€ ê°™ì€ ì¸ì¦ê³¼ ê´€ë ¨ëœ ë°ì´í„°ë¥¼ í•¨ë¶€ë¡œ ìš”ì²­ ë°ì´í„°ì— ë‹´ì§€ ì•Šë„ë¡ ë˜ì–´ìˆë‹¤.**

ë”°ë¼ì„œ ìš”ì²­ê³¼ ì‘ë‹µì—¥ ì¿ í‚¤ë¥¼ í—ˆìš©í•˜ê³  ì‹¶ì„ ê²½ìš°, ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ì˜µì…˜ì´ ë°”ë¡œ `withCredentials` ì˜µì…˜ì´ë‹¤.

`withCredentials` ì˜µì…˜ì€ **ì„œë¡œ ë‹¤ë¥¸ ë„ë©”ì¸(Cross Origin)ì— ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ìš”ì²­ì— `ì¸ì¦(credential)` ì •ë³´ë¥¼ ë‹´ì•„ì„œ ë³´ë‚¼ì§€ë¥¼ ê²°ì •**í•˜ëŠ” í•­ëª©ì´ë‹¤.

ì¦‰, `ì¿ í‚¤`ë‚˜ `ì¸ì¦ í—¤ë”` ì •ë³´ë¥¼ í¬í•¨ì‹œì¼œ ìš”ì²­í•˜ê³  ì‹¶ë‹¤ë©´, **í´ë¼ì´ì–¸íŠ¸**ì—ì„œ API ìš”ì²­ ë©”ì†Œë“œë¥¼ ë³´ë‚¼ë•Œ `withCredentials` ì˜µì…˜ì„ trueë¡œ ì„¤ì •í•´ì•¼í•œë‹¤.

ë˜í•œ ì¸ì¦ëœ ìš”ì²­ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„  í´ë¼ì´ì–¸íŠ¸ ë¿ë§Œ ì•„ë‹ˆë¼ **ì„œë²„**ì—ì„œë„ `Access-Control-Allow-Credentials` í—¤ë”ë¥¼ trueë¡œ í•¨ìœ¼ë¡œì¨ ì¸ì¦ ì˜µì…˜ì„ ì„¤ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.

ì •ë¦¬í•˜ìë©´, **í´ë¼ì´ì–¸íŠ¸ë‚˜ ì„œë²„ë‚˜ ë‘˜ë‹¤ Credentials ë¶€ë¶„ì„ trueë¡œ ì„¤ì •**í•´ì¤˜ì•¼ í•œë‹¤.

1. í‘œì¤€ CORS ìš”ì²­ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì¿ í‚¤ë¥¼ ì„¤ì •í•˜ê±°ë‚˜ ë³´ë‚¼ ìˆ˜ ì—†ë‹¤.
2. í”„ë¡ íŠ¸ì—ì„œ ajax ìš”ì²­í•  ë•Œ, `withCredentials` ë¶€ë¶„ì„ trueë¡œ í•´ì„œ (ìˆ˜ë™ìœ¼ë¡œ) CORS ìš”ì²­ì— ì¿ í‚¤ ê°’ì„ ë„£ì–´ì¤˜ì•¼ í•œë‹¤.
3. ë°±ì—”ë“œ(ì„œë²„)ì—ì„œë„ ì‘ë‹µ í—¤ë”ì— `Access-Control-Allow-Credentials`ë¥¼ trueë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.

> í”„ë¡ íŠ¸ ì„¤ì •: axios ì„¤ì •

`withCredentials` ì˜µì…˜ ë¶€ë¶„ì„ axios ì „ì—­ ì„¤ì •ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ axios ìš”ì²­ ë©”ì„œë“œì˜ ì˜µì…˜ ì¸ìë¡œ ë„£ì–´ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

ë‘ ê°€ì§€ ì¤‘ í•œê°œë¥¼ ì„ íƒí•˜ë©´ ë˜ëŠ”ë°, í•´ë‹¹ í”„ë¡œì íŠ¸ëŠ” í›„ìë¡œ ì ìš©í–ˆë‹¤.

> index.ts

```typescript
import { API_ERROR } from '@/constants/strings/error';
import axios, { type AxiosResponse } from 'axios';

export const headers = {
    'Content-Type': 'application/json;charset=utf-8',
    'Content-Encoding': 'gzip'
};

export const apiInstance = () => {
    const instance = axios.create({
        baseURL: import.meta.env.VITE_APP_BASE_URL,
        headers: { ...headers },
        withCredentials: true
    });
    instance.defaults.timeout = import.meta.env.VITE_APP_TIMEOUT_TIME;

    instance.interceptors.response.use(
        (res: AxiosResponse) => {
            return res;
        },
        (err) => {
            if (err.code === 'ECONNABORTED') {
                err.message = API_ERROR.TIMEOUT;
                return Promise.reject(err);
            } else {
                return Promise.reject(err);
            }
        }
    );

    return instance;
};
```

> ë°±ì—”ë“œ(ì„œë²„) ì„¤ì •: Spring

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    private final List<String> allowOriginUrlPatterns;

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        String[] patterns = allowOriginUrlPatterns.stream()
                .toArray(String[]::new);

        registry.addMapping("/**")
                .allowedMethods("*") // í—ˆìš©í•  HTTP method
                .allowedOrigins(patterns) // í—ˆìš©í•  ì¶œì²˜
                .allowCredentials(true);
    }
}
```

> (ì¶”ê°€) ì„œë²„ EC2ì˜ NGINX ì„¤ì • - default

í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œ NGINXì™€ SSLë¥¼ ì´ìš©í•œ HTTPSë¥¼ ì ìš©í•˜ë©´ì„œ, ì„œë²„ì—ì„œë„ `Access-Control-Allow-Credentials`ë¥¼ trueë¡œ ì„¤ì •í•´ì¤˜ì•¼ í•œë‹¤.

ê²½ë¡œ: /etc/nginx/sites-available/default

```shell
server {
  
    server_name goodfriends.pro;
    location / {
      if ($request_method = 'OPTIONS') 
        {
                            add_header 'Access-Control-Allow-Origin' 'https://goodfriends.life';
                            add_header 'Access-Control-Allow-Credentials' 'true'; # allowed Set-Cookie
                            add_header 'Access-Control-Allow-Methods' 'GET, POST, DELETE, PUT, PATCH, OPTIONS';
                            
                            ...
                            return 204;
                            
        }
        listen [::]:443 ssl ipv6only=on; # managed by Certbot
        listen 443 ssl; # managed by Certbot
        ssl_certificate /etc/letsencrypt/live/goodfriends.pro/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/goodfriends.pro/privkey.pem; # managed by Certbot
        include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    
    }

}
```

## ë§ˆì¹˜ë©°

í”„ë¡œì íŠ¸ì— Set-Cookieì˜ ë³´ì•ˆ ì†ì„± ì ìš© ë°©ë²•ê³¼ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ì„ ê²½í—˜í–ˆë‹¤. ì¿ í‚¤ì— ëŒ€í•œ ê°œë…, ê·¸ë¦¬ê³  ë³´ì•ˆ ì†ì„±, ì¿ í‚¤ë¥¼ ì´ìš©í•œ CORS ì„¤ì • ë“± ì—¬ëŸ¬ ê°œë…ë“¤ì„ ì•Œ ìˆ˜ ìˆëŠ” ê¸°íšŒì˜€ê³ , ë³´ì•ˆì— ëŒ€í•œ ì¤‘ìš”ì„±ì„ ë‹¤ì‹œ í•œë²ˆ ëŠê¼ˆë‹¤.

ìœ„ì˜ ë°©ì‹ìœ¼ë¡œ ê¸°ëŠ¥ì ìœ¼ë¡œ ì‘ë™ë˜ì§€ë§Œ, ì™„ë²½íˆ í•´ê²°í–ˆë‹¤ê³  ë³¼ ìˆœ ì—†ë‹¤ê³  ìƒê°í•œë‹¤. ë¦¬í”„ë ˆì‹œ í† í°ì— ëŒ€í•œ ë³´ì•ˆì€ ë˜ì—ˆìœ¼ë‚˜, ì•¡ì„¸ìŠ¤ í† í°ì€ ì—¬ì „íˆ ResponseBodyë¡œ ì €ì¥ë˜ì–´ ìˆì–´ì„œ ì–¸ì œë“  í•´ì»¤ì™€ ê°™ì€ ì•…ì„± ì‚¬ìš©ìë¡œë¶€í„° í† í° ê°’ì„ íƒˆì·¨ë‹¹í•  ìˆ˜ ìˆë‹¤.

í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ë‚˜ì¤‘ì— ë” ë‚˜ì€ ëŒ€ì•ˆì´ ìˆë‹¤ë©´, ë¦¬íŒ©í„°ë§ì„ í†µí•´ ë” ì•ˆì „í•˜ê²Œ ë³´í˜¸í•  ìˆ˜ ìˆë„ë¡ í•˜ì.


## Reference

* [CORS ì¿ í‚¤ ì „ì†¡í•˜ê¸° (withCredentials ì˜µì…˜)](https://inpa.tistory.com/entry/AXIOS-%F0%9F%93%9A-CORS-%EC%BF%A0%ED%82%A4-%EC%A0%84%EC%86%A1withCredentials-%EC%98%B5%EC%85%98)

* [[10ë¶„ í…Œì½”í†¡] ë‚˜ë´„ì˜ CORS](https://www.youtube.com/watch?v=-2TgkKYmJt4&ab_channel=%EC%9A%B0%EC%95%84%ED%95%9C%ED%85%8C%ED%81%AC)